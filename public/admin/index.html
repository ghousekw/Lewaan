<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Lewan Interior Design - Content Manager</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <style>
    /* Custom styles for portfolio grid view */
    [data-collection-name="portfolio"] .nc-collectionPage-cards {
      display: grid !important;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)) !important;
      gap: 20px !important;
      padding: 20px !important;
    }
    
    [data-collection-name="portfolio"] .nc-collectionPage-card {
      border: 1px solid #e0e0e0 !important;
      border-radius: 8px !important;
      overflow: hidden !important;
      transition: all 0.3s ease !important;
      background: white !important;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
    }
    
    [data-collection-name="portfolio"] .nc-collectionPage-card:hover {
      transform: translateY(-4px) !important;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15) !important;
    }
    
    [data-collection-name="portfolio"] .nc-collectionPage-cardBody {
      padding: 15px !important;
    }
    
    [data-collection-name="portfolio"] .nc-collectionPage-cardHeading {
      font-size: 16px !important;
      font-weight: 600 !important;
      margin-bottom: 8px !important;
      color: #1a1a1a !important;
    }
    
    [data-collection-name="portfolio"] .nc-collectionPage-cardDescription {
      font-size: 14px !important;
      color: #666 !important;
      margin-bottom: 4px !important;
    }
    
    /* Add thumbnail preview to cards */
    [data-collection-name="portfolio"] .nc-collectionPage-card::before {
      content: '';
      display: block;
      width: 100%;
      height: 200px;
      background-size: cover !important;
      background-position: center !important;
      background-repeat: no-repeat !important;
    }
    
    /* Grid/List view toggle button styling */
    .nc-collectionPage-viewControls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <!-- Include the script that builds the page and powers Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    (function() {
      const hash = window.location.hash || '';
      const hasIdentityToken = hash && (
        hash.includes('invite_token') ||
        hash.includes('confirmation_token') ||
        hash.includes('recovery_token') ||
        hash.includes('access_token')
      );

      if (window.netlifyIdentity) {
        window.netlifyIdentity.on('init', (user) => {
          if (!user && hasIdentityToken) {
            window.netlifyIdentity.open();
          }
        });
        window.netlifyIdentity.init();
      }
    })();
  </script>
  <script>
    // Add custom collection preview template after CMS loads
    window.addEventListener('load', function() {
      // Wait for CMS to be available
      const checkCMS = setInterval(function() {
        if (window.CMS) {
          clearInterval(checkCMS);
          
          // Custom event handler to inject gallery counts
          CMS.registerEventListener({
            name: 'postPublish',
            handler: ({ entry }) => {
              console.log('Entry published:', entry);
            }
          });
          
          // Add thumbnail images and gallery count to portfolio cards
          const observer = new MutationObserver(function(mutations) {
            const portfolioCards = document.querySelectorAll('[data-collection-name="portfolio"] .nc-collectionPage-card');
            
            portfolioCards.forEach(card => {
              const heading = card.querySelector('.nc-collectionPage-cardHeading');
              const description = card.querySelector('.nc-collectionPage-cardDescription');
              
              if (heading && !card.dataset.enhanced) {
                // Extract data from card
                const cardText = card.textContent;
                
                // Extract thumbnail
                const thumbnailMatch = cardText.match(/thumbnail[:\s]*([^\s,}]+)/i);
                if (thumbnailMatch && thumbnailMatch[1]) {
                  const thumbnail = thumbnailMatch[1].replace(/['"]/g, '');
                  card.style.setProperty('--thumbnail-url', `url(${thumbnail})`);
                  card.classList.add('has-thumbnail');
                }
                
                // Count gallery items dynamically
                const galleryMatches = cardText.match(/gallery[\s\S]*?"type":\s*"(image|video)"/g);
                const galleryCount = galleryMatches ? galleryMatches.length : 0;
                
                // Add gallery count to description
                if (description && galleryCount > 0) {
                  const currentText = description.textContent;
                  if (!currentText.includes('images')) {
                    description.textContent = `${galleryCount} image${galleryCount !== 1 ? 's' : ''} | ${currentText}`;
                    description.style.color = '#666';
                    description.style.fontSize = '13px';
                  }
                }
                
                card.dataset.enhanced = 'true';
              }
            });
          });
          
          observer.observe(document.body, {
            childList: true,
            subtree: true
          });
        }
      }, 100);
    });
  </script>
  <style>
    /* Apply thumbnail as background using CSS variable */
    [data-collection-name="portfolio"] .nc-collectionPage-card.has-thumbnail::before {
      background-image: var(--thumbnail-url) !important;
    }
  </style>
</body>
</html>
