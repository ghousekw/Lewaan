<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Lewan Interior Design - Content Manager</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <style>
    /* Wait for CMS to load, then inject grid styles */
  </style>
</head>
<body>
  <!-- Include the script that builds the page and powers Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    (function() {
      const hash = window.location.hash || '';
      const hasIdentityToken = hash && (
        hash.includes('invite_token') ||
        hash.includes('confirmation_token') ||
        hash.includes('recovery_token') ||
        hash.includes('access_token')
      );

      if (window.netlifyIdentity) {
        window.netlifyIdentity.on('init', (user) => {
          if (!user && hasIdentityToken) {
            window.netlifyIdentity.open();
          }
        });
        window.netlifyIdentity.init();
      }
    })();
  </script>
  <script>
    // Custom Portfolio Grid View with Thumbnails and Dynamic Gallery Count
    window.addEventListener('load', function() {
      const checkCMS = setInterval(function() {
        if (window.CMS) {
          clearInterval(checkCMS);
          console.log('ðŸŽ¨ Lewan CMS: Initializing custom portfolio view...');
          
          // Inject custom styles dynamically
          const style = document.createElement('style');
          style.textContent = `
            /* Portfolio Grid Layout */
            div[class*="CollectionTop"] ~ div > div {
              display: grid !important;
              grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
              gap: 20px !important;
              padding: 20px !important;
            }
            
            /* Portfolio Cards */
            div[class*="CollectionTop"] ~ div > div > a {
              border: 1px solid #e2e8f0 !important;
              border-radius: 12px !important;
              overflow: hidden !important;
              transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
              background: white !important;
              box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
              display: flex !important;
              flex-direction: column !important;
            }
            
            div[class*="CollectionTop"] ~ div > div > a:hover {
              transform: translateY(-4px) !important;
              box-shadow: 0 12px 24px rgba(0,0,0,0.15) !important;
              border-color: #cbd5e0 !important;
            }
            
            /* Card Content */
            div[class*="CollectionTop"] ~ div > div > a > div {
              padding: 16px !important;
            }
            
            /* Card Title */
            div[class*="CollectionTop"] ~ div > div > a h2 {
              font-size: 18px !important;
              font-weight: 600 !important;
              color: #1a202c !important;
              margin-bottom: 8px !important;
            }
            
            /* Card Description */
            div[class*="CollectionTop"] ~ div > div > a p {
              font-size: 14px !important;
              color: #718096 !important;
              line-height: 1.5 !important;
            }
            
            /* Thumbnail Badge */
            .portfolio-thumbnail {
              width: 100%;
              height: 200px;
              object-fit: cover;
              background: #f7fafc;
            }
            
            /* Gallery Count Badge */
            .gallery-count-badge {
              display: inline-block;
              background: #4299e1;
              color: white;
              padding: 4px 12px;
              border-radius: 12px;
              font-size: 12px;
              font-weight: 600;
              margin-bottom: 8px;
            }
          `;
          document.head.appendChild(style);
          
          // Monitor DOM changes and enhance portfolio cards
          const observer = new MutationObserver(function(mutations) {
            // Find all portfolio collection links
            const portfolioLinks = document.querySelectorAll('a[href*="/collections/portfolio/entries/"]');
            
            portfolioLinks.forEach(link => {
              if (!link.dataset.enhanced) {
                enhancePortfolioCard(link);
                link.dataset.enhanced = 'true';
              }
            });
          });
          
          observer.observe(document.body, {
            childList: true,
            subtree: true
          });
          
          // Function to enhance portfolio card with thumbnail and count
          async function enhancePortfolioCard(link) {
            try {
              const href = link.getAttribute('href');
              const slug = href.split('/').pop();
              
              // Fetch the portfolio item data
              const response = await fetch(`/src/content/portfolio/${slug}.json`);
              if (!response.ok) return;
              
              const data = await response.json();
              const galleryCount = data.gallery ? data.gallery.length : 0;
              
              // Find or create thumbnail container
              let thumbnailContainer = link.querySelector('.portfolio-thumbnail');
              if (!thumbnailContainer && data.thumbnail) {
                thumbnailContainer = document.createElement('img');
                thumbnailContainer.className = 'portfolio-thumbnail';
                thumbnailContainer.src = data.thumbnail;
                thumbnailContainer.alt = data.en?.title || 'Portfolio thumbnail';
                thumbnailContainer.loading = 'lazy';
                link.insertBefore(thumbnailContainer, link.firstChild);
              }
              
              // Add gallery count badge
              const cardContent = link.querySelector('div');
              if (cardContent && galleryCount > 0) {
                let badge = cardContent.querySelector('.gallery-count-badge');
                if (!badge) {
                  badge = document.createElement('span');
                  badge.className = 'gallery-count-badge';
                  badge.textContent = `ðŸ“· ${galleryCount} image${galleryCount !== 1 ? 's' : ''}`;
                  cardContent.insertBefore(badge, cardContent.firstChild);
                }
              }
              
              console.log(`âœ… Enhanced: ${data.en?.title} (${galleryCount} images)`);
            } catch (err) {
              console.log('Note: Could not load portfolio data for', link.href, '-', err.message);
            }
          }
          
          console.log('âœ¨ Lewan CMS: Custom portfolio view ready!');
        }
      }, 100);
    });
  </script>
</body>
</html>
