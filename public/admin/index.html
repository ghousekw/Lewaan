<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Lewan Interior Design - Content Manager</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <style>
    /* Wait for CMS to load, then inject grid styles */
  </style>
</head>
<body>
  <!-- Include the script that builds the page and powers Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    (function() {
      const hash = window.location.hash || '';
      const hasIdentityToken = hash && (
        hash.includes('invite_token') ||
        hash.includes('confirmation_token') ||
        hash.includes('recovery_token') ||
        hash.includes('access_token')
      );

      if (window.netlifyIdentity) {
        window.netlifyIdentity.on('init', (user) => {
          if (!user && hasIdentityToken) {
            window.netlifyIdentity.open();
          }
        });
        window.netlifyIdentity.init();
      }
    })();
  </script>
  <script>
    // Custom Portfolio Grid View - Dynamic DOM Manipulation
    (function() {
      let styleInjected = false;
      
      function injectStyles() {
        if (styleInjected) return;
        styleInjected = true;
        
        const style = document.createElement('style');
        style.id = 'lewan-portfolio-grid';
        style.textContent = `
          /* Force grid on any container with portfolio links - Very broad selectors */
          .lewan-portfolio-grid,
          div:has(a[href*="portfolio"][href*="entries"]) {
            display: grid !important;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)) !important;
            gap: 20px !important;
            padding: 20px !important;
          }
          
          /* Style portfolio cards - Multiple selector strategies */
          .lewan-portfolio-card,
          a[href*="portfolio"][href*="entries"] {
            border: 1px solid #e2e8f0 !important;
            border-radius: 12px !important;
            padding: 20px !important;
            background: white !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08) !important;
            transition: all 0.3s ease !important;
            text-decoration: none !important;
            display: block !important;
            margin-bottom: 0 !important;
          }
          
          .lewan-portfolio-card:hover,
          a[href*="portfolio"][href*="entries"]:hover {
            transform: translateY(-4px) !important;
            box-shadow: 0 12px 24px rgba(0,0,0,0.12) !important;
            border-color: #cbd5e0 !important;
          }
        `;
        document.head.appendChild(style);
      }
      
      function findAndStylePortfolio() {
        // Find all portfolio entry links - multiple strategies
        const portfolioLinks = Array.from(document.querySelectorAll('a')).filter(a => {
          const href = (a.getAttribute('href') || '').toLowerCase();
          return href.includes('portfolio') && (href.includes('entries') || href.includes('entry'));
        });
        
        if (portfolioLinks.length === 0) {
          // Try alternative: look for any links in portfolio collection
          const altLinks = Array.from(document.querySelectorAll('a[href*="portfolio"]'));
          if (altLinks.length > 2) {
            console.log(`Found ${altLinks.length} portfolio-related links`);
          }
          return false;
        }
        
        console.log(`Found ${portfolioLinks.length} portfolio entry links`);
        
        // Strategy 1: Find common parent and apply grid
        let container = portfolioLinks[0];
        for (let i = 0; i < 15; i++) {
          container = container.parentElement;
          if (!container) break;
          
          const linksInContainer = Array.from(container.querySelectorAll('a')).filter(a => {
            const href = (a.getAttribute('href') || '').toLowerCase();
            return href.includes('portfolio') && (href.includes('entries') || href.includes('entry'));
          });
          
          if (linksInContainer.length >= portfolioLinks.length * 0.8) {
            // Found likely container
            container.classList.add('lewan-portfolio-grid');
            container.style.display = 'grid';
            container.style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
            container.style.gap = '20px';
            container.style.padding = '20px';
            
            // Style each link
            linksInContainer.forEach(link => {
              link.classList.add('lewan-portfolio-card');
              link.style.border = '1px solid #e2e8f0';
              link.style.borderRadius = '12px';
              link.style.padding = '20px';
              link.style.background = 'white';
              link.style.boxShadow = '0 2px 4px rgba(0,0,0,0.08)';
            });
            
            console.log(`âœ… Applied grid to container with ${linksInContainer.length} items`);
            return true;
          }
        }
        
        // Strategy 2: Apply styles directly to links if container search failed
        portfolioLinks.forEach(link => {
          link.classList.add('lewan-portfolio-card');
          link.style.border = '1px solid #e2e8f0';
          link.style.borderRadius = '12px';
          link.style.padding = '20px';
          link.style.background = 'white';
          link.style.boxShadow = '0 2px 4px rgba(0,0,0,0.08)';
          link.style.display = 'block';
          link.style.marginBottom = '20px';
        });
        
        console.log(`âœ… Applied card styles to ${portfolioLinks.length} items`);
        return true;
      }
      
      // Wait for CMS
      window.addEventListener('load', function() {
        const checkCMS = setInterval(function() {
          if (window.CMS) {
            clearInterval(checkCMS);
            console.log('ðŸŽ¨ Lewan CMS: Initializing...');
            
            injectStyles();
            
            // Watch for DOM changes
            const observer = new MutationObserver(function() {
              findAndStylePortfolio();
            });
            
            observer.observe(document.body, {
              childList: true,
              subtree: true
            });
            
            // Try immediately and after delays
            setTimeout(findAndStylePortfolio, 500);
            setTimeout(findAndStylePortfolio, 1500);
            setTimeout(findAndStylePortfolio, 3000);
            
            console.log('âœ¨ Lewan CMS: Ready!');
          }
        }, 100);
      });
    })();
  </script>
</body>
</html>
